\RequirePackage{mathtools}
\RequirePackage{amsfonts}
\RequirePackage{array}
\RequirePackage{amssymb}
\RequirePackage{amsmath}

\newlength{\rowidth}% row operation width
\AtBeginDocument{\setlength{\rowidth}{3em}}

\DeclareMathOperator{\trace}{tr}
\DeclareMathOperator{\rank}{rank}
\DeclareMathOperator{\nullity}{nullity}
\DeclareMathOperator{\spn}{span}
\DeclareMathOperator{\vol}{vol}
\DeclareMathOperator{\id}{id}

\DeclarePairedDelimiter\abs{\lvert}{\rvert}%
\DeclarePairedDelimiter\norm{\lVert}{\rVert}%

% Swap starred and non-starred versions of \absval and \norm
\makeatletter
\let\oldabs\abs
\def\abs{\@ifstar{\oldabs}{\oldabs*}}
\let\oldnorm\norm
\def\norm{\@ifstar{\oldnorm}{\oldnorm*}}
\makeatother

\newcommand*{\transpose}{\mkern-1.5mu\mathsf{T}}

\newenvironment{linsys}[2][m]{%
\setlength{\arraycolsep}{.1111em}
\begin{array}[#1]{@{}*{#2}{rc}r@{}}
}{%
\end{array}}

\newenvironment{amatrix}[1]{%
  \left[\begin{array}{@{}*{#1}{r}|*{#1}{r}@{}}
}{%
  \end{array}\right]
}

\newcommand{\ro}[1]{%
  \xrightarrow{\mathmakebox[\rowidth]{#1}}%
}

\newcommand\spanset[1]{\ensuremath\spn(#1)}

\newcommand\largeblock[3]{
  \multicolumn{#1}{c}
    {\raisebox{\dimexpr\normalbaselineskip+#2\ht\strutbox-1.15\height}[0pt][0pt]
      {\scalebox{#1}{#3}}}
}

\newcommand\smallblock[3]{
  \raisebox{\dimexpr\normalbaselineskip+#2\ht\strutbox-1.15\height}[0pt][0pt]
    {\scalebox{#1}{#3}}
}
